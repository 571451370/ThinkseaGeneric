var JavascriptUploadFileDemo;(function(n){function t(n,i){return i===void 0&&(i="0.##"),n>=t.FileLengthEB?(n*1/t.FileLengthEB).format(i)+" EB":n>=t.FileLengthPB?(n*1/t.FileLengthPB).format(i)+" PB":n>=t.FileLengthTB?(n*1/t.FileLengthTB).format(i)+" TB":n>=t.FileLengthGB?(n*1/t.FileLengthGB).format(i)+" GB":n>=t.FileLengthMB?(n*1/t.FileLengthMB).format(i)+" MB":n>=t.FileLengthKB?(n*1/t.FileLengthKB).format(i)+" KB":n+" B"}function e(n){var t="";switch(n){case".ico":t="ico";break;case".bmp":t="bmp";break;case".gif":t="gif";break;case".jpg":case".jpeg":case".jpe":t="jpg";break;case".png":t="png";break;case".svgz":case".svg":t="svg";break;case".mp4":case".webm":case".ogv":case".rm":case".rmvb":case".mpg":case".mpeg":case".mpeg4":case".avi":case".wmv":case".mov":case".mkv":case".3gp":case".flv":case".f4v":t="video";break;case".flac":case".ape":case".mp3":case".wma":case".wav":t="audio";break;case".zip":t="zip";break;case".rar":t="rar";break;case".7z":t="_7zip";break;case".ai":t="ai";break;case".browser":t="browser";break;case".iso":t="cd";break;case".bat":case".cmd":t="cmd";break;case".css":t="css";break;case".eml":t="email";break;case".emf":t="emf";break;case".doc":case".docx":case".wps":t="word";break;case".xls":case".xlsx":case".et":t="excel";break;case".ppt":case".pptx":case".dps":t="ppt";break;case".exe":t="exe";break;case".fla":t="flash";break;case".font":t="font";break;case".help":t="help";break;case".js":t="js";break;case".pdf":t="pdf";break;case".psd":t="psd";break;case".raw":t="raw";break;case".rtf":t="rtf";break;case".swf":t="swf";break;case".tif":t="tif";break;case".txt":t="txt";break;case".wmf":t="wmf";break;default:t="system"}return"filetypes "+t}function i(n){n.hasClass("uploadItem")&&(n=n.parent());var t=n.find(".uploadItem[data-uploadstate='wait']").first();t.length>0&&r(t[0].file,t)}function o(n){var t=$("#"+n.CustomParameter);t.attr("data-begin_upload_time",(new Date).toString());t.attr("data-start_position",n.StartPosition)}function s(n){var p=n.FinishedSize*100/n.FileLength,ut=t(n.FinishedSize,"0.#"),ft=t(n.FileLength,"0.#"),r=$("#"+n.CustomParameter),e=r.find("progress"),c,l,s,a,f,h,y;e.prop("value",Math.round(n.FinishedSize*1/n.FileLength*parseInt(e.prop("max"))));e.children(".ie").css("width",Math.round(p)+"%");var u="",w=new Date,b=new Date(r.attr("data-begin_upload_time")),k=parseInt(r.attr("data-start_position")),d=(w.getTime()-b.getTime())/1e3,g=n.FinishedSize-k,nt=g/d,o=n.FileLength/nt,v=Math.floor(o/86400),tt=Math.floor(o%86400/3600),it=Math.floor(o%3600/60),rt=Math.ceil(o%60);if(v>0&&(u+=v.format("0")+"."),u+=tt.format("00")+":",u+=it.format("00")+":",u+=rt.format("00"),r.find(".fileSize").text(Math.round(n.FinishedSize*1/n.FileLength*100)+"%,剩余时间:"+u),n.FinishedSize==n.FileLength&&(c=n.ResultData,e.hide(),r.find(".fileUpload").val(""),r.attr("data-uploadstate","success"),r.find(".uploadState").text(c.IsFastUpload?"秒传完成":"上传完成").css("color","green").removeAttr("title").show(),r.hasClass("uploadItem"))){if(l=c,r.find(".fileSize").text(t(l.FileLength,"0.#")),r.attr("data-savepath",l.SavePath),s=r.parent().parent(),s.prop("id")==="ctl5"){for(a=s.find(".uploadItem[data-uploadstate='success']"),f="",h=0;h<a.length;h++)f.length>0&&(f+=";"),f+=$(a[h]).attr("data-savepath");y=s.find("input[name='fileUrls']");y.val(f)}i(r)}}function h(n){var t=$("#"+n.CustomParameter),r=t.find("progress");r.hide();t.find(".fileSize").hide();t.find(".fileUpload").val("");t.attr("data-uploadstate","error");t.find(".uploadState").text("上传出错！").css("color","red").attr("title",n.Message).show();t.hasClass("uploadItem")&&i(t)}function c(n){var t=$("#"+n.CustomParameter),r=t.find("progress");r.hide();t.find(".fileSize").hide();t.find(".fileUpload").val("");t.attr("data-uploadstate","abort");t.find(".uploadState").text("操作取消！").css("color","darkgray").show();t.hasClass("uploadItem")&&i(t)}function r(n,t){var u=t.find("progress"),r,i;u.show();r=t.find(".fileSize");r.text("正在上传…");r.show();i=new Thinksea.Net.FileUploader.HttpFileUpload;i.uploadServiceUrl="/HttpUploadHandler.ashx";i.beginUpload=o;i.uploadProgressChanged=s;i.errorOccurred=h;i.onabort=c;t[0].uploader=i;i.startUpload(n,t.prop("id"))}function u(n,t){var u,c,a,l,f,o,s,h;if(n.preventDefault&&n.preventDefault(),u=n.dataTransfer&&n.dataTransfer.files||n.originalEvent&&n.originalEvent.dataTransfer.files||n.files,u&&u.length>0)if(t.prop("id")==="ctl5"){if(c=t.find(".fileinsertmark"),c.length==0){alert("ERROR：未找到文件插入标记元素。");return}for(a=t.prop("id"),l=0,f=0;f<u.length;f++){o=u[f];s=void 0;do s=a+"_file"+l.toString(),l++;while(t.find("#"+s).length>0);h=$('<div id="'+s+'" class="uploadItem thumbnail pull-left" style="position: relative; width: 350px; margin: 5px;" data-uploadstate="wait">    <div class="uploadThumbnail pull-left '+e(o.name.getExtensionName().toLowerCase())+'" style="width: 32px; height: 32px; margin:3px 5px 3px 3px;"><\/div>    <div class="pull-left">        <div style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 240px;" title="'+htmlEncode(o.name)+'">'+htmlEncode(o.name)+'<\/div>        <progress max="100" class="progress progress-striped active progress-success" style="margin-bottom: unset; height: 10px; width: 80px; margin-top: 5px;">            <span class="ie" style="display: block; height: 10px;"><\/span>        <\/progress>        <span class="fileSize" style="color: darkgray;">待上传，请稍后…<\/span>        <span class="uploadState" style="display: none;"><\/span>    <\/div>    <button type="button" class="deleteButton btn btn-link pull-right">删除<\/button><\/div>');h.find(".deleteButton").on("click",function(){var n=$(this).parent(),t=n[0].uploader,r;t&&t.cancelUpload();r=n.parent();n.remove();i(r)});h.insertBefore(c);h[0].file=u[f]}i(t)}else r(u[0],t)}function f(n){n.find(".fileUpload").change(function(){u(this,n)});n.find("[data-clickupload='true']").click(function(){n.find(".fileUpload").click()});n.find("[data-dragoverupload='true']").on("dragover",function(n){n.preventDefault()}).on("drop",function(t){u(t,n)})}function l(){return($("form").validator("validate"),!$("form")[0].checkValidity())?!1:!0}function a(){$("body").on("dragover",function(n){n.preventDefault()});$("body")[0].ondrop=function(n){n.preventDefault()};f($("#ctl5"));$("form").submit(function(){return l()})}(function(n){n.FileLengthB=1;n.FileLengthKB=n.FileLengthB*1024;n.FileLengthMB=n.FileLengthKB*1024;n.FileLengthGB=n.FileLengthMB*1024;n.FileLengthTB=n.FileLengthGB*1024;n.FileLengthPB=n.FileLengthTB*1024;n.FileLengthEB=n.FileLengthPB*1024})(t||(t={}));n.initUploadControl=f;n.init=a})(JavascriptUploadFileDemo||(JavascriptUploadFileDemo={}));$(function(){JavascriptUploadFileDemo.init()});