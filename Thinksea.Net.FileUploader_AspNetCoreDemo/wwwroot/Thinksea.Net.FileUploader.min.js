var Thinksea;(function(n){var t;(function(t){var i;(function(t){var i=function(){function t(){this.uploadServiceUrl="";this.beginUpload=null;this.findBreakpoint=null;this.uploadProgressChanged=null;this.errorOccurred=null;this.onabort=null;this.checkCode=null;this.cancelling=!1}return t.arrayBufferToWordArray=function(n){for(var t=new Uint8Array(n),r=[],i=0;i<t.length;i+=4)r.push(t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3]);return CryptoJS.lib.WordArray.create(r,t.length)},t.prototype.getCheckCode=function(t){function o(){var f,n;if(u=Math.min(r+s,t.size),i.cancelling===!0){if(i.onabort){f={CustomParameter:i.customParameter};i.onabort(f)}return}t.slice?n=t.slice(r,u):t.webkitSlice?n=t.webkitSlice(r,u):File.prototype.mozSlice&&(n=t.mozSlice(r,u));e.readAsArrayBuffer(n)}var i=this,s=204800,r=0,u=0,f=CryptoJS.algo.SHA1.create(),e=new FileReader;e.onload=function(e){if(r=u,f.update(n.Net.FileUploader.HttpFileUpload.arrayBufferToWordArray(e.target.result)),r<t.size)o();else{var s=f.finalize();i.checkCode=s.toString().toUpperCase();i.startFastUpload(t)}};o()},t.prototype.startFastUpload=function(n){var t=this,u,r,i;if(t.cancelling===!0){if(t.onabort){u={CustomParameter:t.customParameter};t.onabort(u)}return}r=t.uploadServiceUrl;r=r.setUriParameter("cmd","fastupload").setUriParameter("filename",n.name).setUriParameter("filesize",n.size.toString()).setUriParameter("checkcode",t.checkCode).setUriParameter("param",t.customParameter);i=new XMLHttpRequest;t.errorOccurred&&i.addEventListener("error",function(n){var i={Message:n.message,CustomParameter:t.customParameter};t.errorOccurred(i)},!1);t.onabort&&i.addEventListener("abort",function(){var n={CustomParameter:t.customParameter};t.onabort(n)},!1);i.addEventListener("load",function(i){var o=i.target.responseText,r=JSON.parse(o),s=r.ErrorCode,u,f,e;s==0?r.Data!==null?(u=n.size,t.uploadProgressChanged&&(f={FinishedSize:u,FileLength:n.size,CustomParameter:t.customParameter,ResultData:r.Data},t.uploadProgressChanged(f))):t.startBreakpointUpload(n):t.errorOccurred?(e={Message:r.Message,CustomParameter:t.customParameter},t.errorOccurred(e)):alert("上传出现错误。"+r.Message)},!1);i.open("POST",r);i.send()},t.prototype.startBreakpointUpload=function(n){var t=this,u,r,i;if(t.cancelling===!0){if(t.onabort){u={CustomParameter:t.customParameter};t.onabort(u)}return}r=t.uploadServiceUrl;r=r.setUriParameter("cmd","getoffset").setUriParameter("filename",n.name).setUriParameter("filesize",n.size.toString()).setUriParameter("checkcode",t.checkCode).setUriParameter("param",t.customParameter);i=new XMLHttpRequest;t.errorOccurred&&i.addEventListener("error",function(n){var i={Message:n.message,CustomParameter:t.customParameter};t.errorOccurred(i)},!1);t.onabort&&i.addEventListener("abort",function(){var n={CustomParameter:t.customParameter};t.onabort(n)},!1);i.addEventListener("load",function(i){var o=i.target.responseText,u=JSON.parse(o),s=u.ErrorCode,r,f,e;s==0?(r=u.Data,t.findBreakpoint&&r!==0&&(f={Breakpoint:r,CustomParameter:t.customParameter},t.findBreakpoint(f),r=f.Breakpoint),t.beginUploadFile(n,r)):t.errorOccurred?(e={Message:u.Message,CustomParameter:t.customParameter},t.errorOccurred(e)):alert("上传出现错误。"+u.Message)},!1);i.open("POST",r);i.send()},t.prototype.beginUploadFile=function(n,t){function s(){var s,t,o,c;if(u=Math.min(r+h,n.size),i.cancelling===!0){if(i.onabort){s={CustomParameter:i.customParameter};i.onabort(s)}return}n.slice?t=n.slice(r,u):n.webkitSlice?t=n.webkitSlice(r,u):File.prototype.mozSlice&&(t=n.mozSlice(r,u));o=new FormData;o.append("fileToUpload",t);c=e.setUriParameter("offset",r.toString());f.open("POST",c);f.send(o)}var i=this,o,e;i.beginUpload&&(o={FileLength:n.size,CustomParameter:i.customParameter,StartPosition:t},i.beginUpload(o));e=i.uploadServiceUrl;e=e.setUriParameter("cmd","upload").setUriParameter("filename",n.name).setUriParameter("filesize",n.size.toString()).setUriParameter("checkcode",i.checkCode).setUriParameter("param",i.customParameter);var h=204800,r=t,u=t,f=new XMLHttpRequest;i.errorOccurred&&f.addEventListener("error",function(n){var t={Message:n.message,CustomParameter:i.customParameter};i.errorOccurred(t)},!1);i.onabort&&f.addEventListener("abort",function(){var n={CustomParameter:i.customParameter};i.onabort(n)},!1);f.addEventListener("load",function(t){var h=t.target.responseText,f=JSON.parse(h),c=f.ErrorCode,e,o;c==0?(r=u,i.uploadProgressChanged&&(e={FinishedSize:r,FileLength:n.size,CustomParameter:i.customParameter,ResultData:f.Data},i.uploadProgressChanged(e)),r<n.size&&s()):i.errorOccurred?(o={Message:f.Message,CustomParameter:i.customParameter},i.errorOccurred(o)):alert("上传出现错误。"+f.Message)},!1);s()},t.prototype.startUpload=function(n,t){var i=this;i.customParameter=t;i.cancelling=!1;i.getCheckCode(n)},t.prototype.cancelUpload=function(){this.cancelling=!0},t}();t.HttpFileUpload=i,function(){}(i=t.HttpFileUpload||(t.HttpFileUpload={}))})(i=t.FileUploader||(t.FileUploader={}))})(t=n.Net||(n.Net={}))})(Thinksea||(Thinksea={}));